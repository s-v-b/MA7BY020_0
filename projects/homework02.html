<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.55">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>homework02 – MA7BY020 - Spring 2025</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="MA7BY020 - Spring 2025">
<meta property="og:description" content="Homepage for course MA7BY020 - Exploratory Data Analysis, Master MIDS Spring 2025.">
<meta property="og:site_name" content="MA7BY020 - Spring 2025">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../images/hexlogo_ma7BY020.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/s-v-b/MA7BY020" title="GitHub organization" class="quarto-navigation-tool px-1" aria-label="GitHub organization"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Moodle" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Moodle"><i class="bi bi-person-fill"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://moodle.u-paris.fr/course/view.php?id=2313">
            Discussion forum
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://moodle.u-paris.fr/course/view.php?id=2313">
            Dépot
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://moodle.u-paris.fr/course/view.php?id=2313">
            Notes
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Information</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Glimpse</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../course-syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../course-team.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Team</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Support</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../computing-access.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Computing resources</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../rstudio-client.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">rstudio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../posit-cloud.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Posit cloud</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../quarto-format.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quarto</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../slides-listings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Slides</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs-listings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Labs</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs-solutions-listings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Solutions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../exams-listings.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exams</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Journal</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/week-1.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/week-2.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/week-3.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 3</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/week-4.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 4</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/week-5.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 5</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/week-6.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 6</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/week-7.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 7</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/week-8.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 8</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/week-9.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 9</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/week-10.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 10</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/week-11.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 11</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/week-12.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 12</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/week-13.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 13</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#propaganda-start-the-spark-session" id="toc-propaganda-start-the-spark-session" class="nav-link active" data-scroll-target="#propaganda-start-the-spark-session">Propaganda, start the <code>spark</code> session</a></li>
  <li><a href="#us-baby-names-1880-2017" id="toc-us-baby-names-1880-2017" class="nav-link" data-scroll-target="#us-baby-names-1880-2017">US Baby Names 1880-2017</a></li>
  <li><a href="#sql-versus-spark-dataframe-api" id="toc-sql-versus-spark-dataframe-api" class="nav-link" data-scroll-target="#sql-versus-spark-dataframe-api">SQL versus spark-Dataframe API</a></li>
  <li><a href="#warmup-compute-the-10-most-popular-names-given-to-babies-in-year-2000." id="toc-warmup-compute-the-10-most-popular-names-given-to-babies-in-year-2000." class="nav-link" data-scroll-target="#warmup-compute-the-10-most-popular-names-given-to-babies-in-year-2000.">Warmup: compute the 10 most popular names given to babies in year 2000.</a>
  <ul class="collapse">
  <li><a href="#using-spark.sql" id="toc-using-spark.sql" class="nav-link" data-scroll-target="#using-spark.sql">Using <code>spark.sql()</code></a></li>
  <li><a href="#a-query-is-a-plain-sql-query-embodied-in-a-string." id="toc-a-query-is-a-plain-sql-query-embodied-in-a-string." class="nav-link" data-scroll-target="#a-query-is-a-plain-sql-query-embodied-in-a-string.">A query is a plain SQL query embodied in a string.</a></li>
  <li><a href="#using-the-dataframedataset-api" id="toc-using-the-dataframedataset-api" class="nav-link" data-scroll-target="#using-the-dataframedataset-api">Using the dataframe/dataset API</a>
  <ul class="collapse">
  <li><a href="#pedestrian-approach" id="toc-pedestrian-approach" class="nav-link" data-scroll-target="#pedestrian-approach">Pedestrian approach</a></li>
  <li><a href="#do-it-again-complying-with-dry-principle" id="toc-do-it-again-complying-with-dry-principle" class="nav-link" data-scroll-target="#do-it-again-complying-with-dry-principle">Do it again, complying with DRY principle</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#name-portfolio-through-ages" id="toc-name-portfolio-through-ages" class="nav-link" data-scroll-target="#name-portfolio-through-ages">Name portfolio through ages</a></li>
  <li><a href="#assessing-popularity-through-time" id="toc-assessing-popularity-through-time" class="nav-link" data-scroll-target="#assessing-popularity-through-time">Assessing popularity through time</a></li>
  <li><a href="#evolution-of-top-popular-names-through-the-century" id="toc-evolution-of-top-popular-names-through-the-century" class="nav-link" data-scroll-target="#evolution-of-top-popular-names-through-the-century">Evolution of top popular names through the century</a></li>
  <li><a href="#plot-the-popularity-of-each-of-the-top-ten-achievers-from-year-2000-with-respect-to-time" id="toc-plot-the-popularity-of-each-of-the-top-ten-achievers-from-year-2000-with-respect-to-time" class="nav-link" data-scroll-target="#plot-the-popularity-of-each-of-the-top-ten-achievers-from-year-2000-with-respect-to-time">Plot the popularity of each of the top ten achievers from year 2000 with respect to time</a></li>
  <li><a href="#plot-the-total-popularity-of-the-top-ten-achievers-from-year-2000-with-respect-to-time" id="toc-plot-the-total-popularity-of-the-top-ten-achievers-from-year-2000-with-respect-to-time" class="nav-link" data-scroll-target="#plot-the-total-popularity-of-the-top-ten-achievers-from-year-2000-with-respect-to-time">Plot the total popularity of the top ten achievers from year 2000 with respect to time</a></li>
  <li><a href="#plot-lorenz-curves" id="toc-plot-lorenz-curves" class="nav-link" data-scroll-target="#plot-lorenz-curves">Plot lorenz curves</a></li>
  <li><a href="#gini-index" id="toc-gini-index" class="nav-link" data-scroll-target="#gini-index">Gini index</a></li>
  <li><a href="#close-the-door-leave-work-area-clean" id="toc-close-the-door-leave-work-area-clean" class="nav-link" data-scroll-target="#close-the-door-leave-work-area-clean">Close the door, leave work area clean</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/s-v-b/MA7BY020/edit/main/projects/homework02.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/s-v-b/MA7BY020/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">




<section id="propaganda-start-the-spark-session" class="level1">
<h1>Propaganda, start the <code>spark</code> session</h1>
<blockquote class="blockquote">
<p>For SQL users, Spark SQL provides state-of-the-art SQL performance and maintains compatibility with Shark/Hive. In particular, like Shark, Spark SQL supports all existing Hive data formats, user-defined functions (UDF), and the Hive metastore.</p>
</blockquote>
<blockquote class="blockquote">
<p>For Spark users, Spark SQL becomes the narrow-waist for manipulating (semi-) structured data as well as ingesting data from sources that provide schema, such as JSON, Parquet, Hive, or EDWs. It truly unifies SQL and sophisticated analysis, allowing users to mix and match SQL and more imperative programming APIs for advanced analytics.</p>
</blockquote>
<blockquote class="blockquote">
<p>For open source hackers, Spark SQL proposes a novel, elegant way of building query planners. It is incredibly easy to add new optimizations under this framework.</p>
</blockquote>
<blockquote class="blockquote">
<p>Internally, a structured query is a Catalyst tree of (logical and physical) relational operators and expressions.</p>
</blockquote>
<div id="530cf1ed" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2020-03-09T14:21:05.390606Z&quot;,&quot;start_time&quot;:&quot;2020-03-09T14:21:04.705930Z&quot;}" data-options="{&quot;caption&quot;:false,&quot;complete&quot;:true,&quot;display_data&quot;:true,&quot;display_stream&quot;:true,&quot;dpi&quot;:200,&quot;echo&quot;:true,&quot;evaluate&quot;:false,&quot;f_env&quot;:null,&quot;f_pos&quot;:&quot;htpb&quot;,&quot;f_size&quot;:[6,4],&quot;f_spines&quot;:true,&quot;fig&quot;:true,&quot;include&quot;:true,&quot;name&quot;:null,&quot;option_string&quot;:&quot;evaluate=False&quot;,&quot;results&quot;:&quot;verbatim&quot;,&quot;term&quot;:false,&quot;wrap&quot;:&quot;output&quot;}" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import the usual suspects</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> timeit</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>sns.set_context(<span class="st">"notebook"</span>, font_scale<span class="op">=</span><span class="fl">1.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>During the session, we will use classes and functions exported by <code>pyspark</code></p>
<div id="dcbbb61f" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2020-03-09T14:21:05.433036Z&quot;,&quot;start_time&quot;:&quot;2020-03-09T14:21:05.393040Z&quot;}" data-options="{&quot;caption&quot;:false,&quot;complete&quot;:true,&quot;display_data&quot;:true,&quot;display_stream&quot;:true,&quot;dpi&quot;:200,&quot;echo&quot;:true,&quot;evaluate&quot;:false,&quot;f_env&quot;:null,&quot;f_pos&quot;:&quot;htpb&quot;,&quot;f_size&quot;:[6,4],&quot;f_spines&quot;:true,&quot;fig&quot;:true,&quot;include&quot;:true,&quot;name&quot;:null,&quot;option_string&quot;:&quot;evaluate=False&quot;,&quot;results&quot;:&quot;verbatim&quot;,&quot;term&quot;:false,&quot;wrap&quot;:&quot;output&quot;}" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># spark</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark <span class="im">import</span> SparkConf, SparkContext</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> SparkSession</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> Window</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.functions <span class="im">import</span> col</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyspark.sql.functions <span class="im">as</span> fn</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.catalog <span class="im">import</span> Catalog</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.types <span class="im">import</span> StructType, StructField</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.types <span class="im">import</span> IntegerType, StringType</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Start the <code>SparkSession</code></p>
<div id="62072a64" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2020-03-09T14:21:08.198302Z&quot;,&quot;start_time&quot;:&quot;2020-03-09T14:21:05.450757Z&quot;}" data-options="{&quot;caption&quot;:false,&quot;complete&quot;:true,&quot;display_data&quot;:true,&quot;display_stream&quot;:true,&quot;dpi&quot;:200,&quot;echo&quot;:true,&quot;evaluate&quot;:false,&quot;f_env&quot;:null,&quot;f_pos&quot;:&quot;htpb&quot;,&quot;f_size&quot;:[6,4],&quot;f_spines&quot;:true,&quot;fig&quot;:true,&quot;include&quot;:true,&quot;name&quot;:null,&quot;option_string&quot;:&quot;evaluate=False&quot;,&quot;results&quot;:&quot;verbatim&quot;,&quot;term&quot;:false,&quot;wrap&quot;:&quot;output&quot;}" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>conf <span class="op">=</span> SparkConf().setAppName(<span class="st">"Spark SQL Illustrations"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>sc <span class="op">=</span> SparkContext(conf<span class="op">=</span>conf)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>spark <span class="op">=</span> (SparkSession</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    .builder</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    .appName(<span class="st">"Spark SQL"</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    .getOrCreate()</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>24/08/09 15:32:51 WARN Utils: Your hostname, boucheron-Precision-5480 resolves to a loopback address: 127.0.1.1; using 192.168.10.120 instead (on interface wlp0s20f3)
24/08/09 15:32:51 WARN Utils: Set SPARK_LOCAL_IP if you need to bind to another address
Setting default log level to "WARN".
To adjust logging level use sc.setLogLevel(newLevel). For SparkR, use setLogLevel(newLevel).
24/08/09 15:32:52 WARN NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable</code></pre>
</div>
</div>
</section>
<section id="us-baby-names-1880-2017" class="level1">
<h1>US Baby Names 1880-2017</h1>
<dl>
<dt>Description</dt>
<dd>
US baby names provided by the SSA.
</dd>
</dl>
<p>This dataset contains all names used for at least 5 children of either sex during a year.</p>
<p>The file is made of <code>1924665</code> lines and 4 columns.</p>
<pre><code>|-- name: string (nullable = true)
    |-- n: integer (nullable = true)
    |-- sex: string (nullable = true)
    |-- year: integer (nullable = true)</code></pre>
<p>Each row indicates for a given name, sex, and year the number of babies of the given sex who were given that name during the given year. Names with less than 5 occurrences during the year were note recorded.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: center;">n</th>
<th style="text-align: center;">sex</th>
<th style="text-align: center;">year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Emilia</td>
<td style="text-align: center;">112</td>
<td style="text-align: center;">F</td>
<td style="text-align: center;">1985</td>
</tr>
<tr class="even">
<td style="text-align: left;">Kelsi</td>
<td style="text-align: center;">112</td>
<td style="text-align: center;">F</td>
<td style="text-align: center;">1985</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Margot</td>
<td style="text-align: center;">112</td>
<td style="text-align: center;">F</td>
<td style="text-align: center;">1985</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mariam</td>
<td style="text-align: center;">112</td>
<td style="text-align: center;">F</td>
<td style="text-align: center;">1985</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Scarlett</td>
<td style="text-align: center;">112</td>
<td style="text-align: center;">F</td>
<td style="text-align: center;">1985</td>
</tr>
</tbody>
</table>
<p>First, we download the data if it’s not there yet</p>
<div id="4632c667" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2020-03-17T14:34:52.211940Z&quot;,&quot;start_time&quot;:&quot;2020-03-17T14:34:52.017286Z&quot;}" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests, zipfile, io</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> Path(<span class="st">'babynames_short.csv'</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> path.exists():</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    url <span class="op">=</span> <span class="st">"https://stephanegaiffas.github.io/big_data_course/data/babynames_short.csv.zip"</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> requests.get(url)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> zipfile.ZipFile(io.BytesIO(r.content))</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    z.extractall(path<span class="op">=</span><span class="st">'./'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Load <code>babynames</code> from a <code>csv</code> file</p>
<div id="78d7dccf" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2020-03-09T14:21:15.599687Z&quot;,&quot;start_time&quot;:&quot;2020-03-09T14:21:09.892952Z&quot;}" data-options="{&quot;caption&quot;:false,&quot;complete&quot;:true,&quot;display_data&quot;:true,&quot;display_stream&quot;:true,&quot;dpi&quot;:200,&quot;echo&quot;:true,&quot;evaluate&quot;:false,&quot;f_env&quot;:null,&quot;f_pos&quot;:&quot;htpb&quot;,&quot;f_size&quot;:[6,4],&quot;f_spines&quot;:true,&quot;fig&quot;:true,&quot;include&quot;:true,&quot;name&quot;:null,&quot;option_string&quot;:&quot;evaluate=False&quot;,&quot;results&quot;:&quot;verbatim&quot;,&quot;term&quot;:false,&quot;wrap&quot;:&quot;output&quot;}" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df_sp <span class="op">=</span> spark.read<span class="op">\</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>             .<span class="bu">format</span>(<span class="st">'csv'</span>)<span class="op">\</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>             .option(<span class="st">"header"</span>, <span class="st">"true"</span>)<span class="op">\</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>             .option(<span class="st">"mode"</span>, <span class="st">"FAILFAST"</span>)<span class="op">\</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>             .option(<span class="st">"inferSchema"</span>, <span class="st">"true"</span>)<span class="op">\</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>             .option(<span class="st">"sep"</span>, <span class="st">","</span>)<span class="op">\</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>             .load(<span class="st">"babynames_short.csv"</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>df_sp.printSchema()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[Stage 1:&gt;                                                        (0 + 16) / 16][Stage 1:=============================&gt;                            (8 + 8) / 16]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>root
 |-- name: string (nullable = true)
 |-- n: integer (nullable = true)
 |-- sex: string (nullable = true)
 |-- year: double (nullable = true)
</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Stage 1:==============================================&gt;          (13 + 3) / 16]                                                                                </code></pre>
</div>
</div>
<p>Ensure that the dataframe has the following schema:</p>
<pre><code>root
    |-- name: string (nullable = true)
    |-- n: integer (nullable = true)
    |-- sex: string (nullable = true)
    |-- year: integer (nullable = true)</code></pre>
</section>
<section id="sql-versus-spark-dataframe-api" class="level1">
<h1>SQL versus spark-Dataframe API</h1>
<blockquote class="blockquote">
<p>Dataset API vs SQL</p>
</blockquote>
<blockquote class="blockquote">
<p>Spark SQL supports two “modes” to write structured queries: Dataset API and SQL. SQL Mode is used to express structured queries using SQL statements using SparkSession.sql operator, expr standard function and spark-sql command-line tool.</p>
</blockquote>
<blockquote class="blockquote">
<p>Some structured queries can be expressed much easier using Dataset API, but there are some that are only possible in SQL. In other words, you may find mixing Dataset API and SQL modes challenging yet rewarding.</p>
</blockquote>
<blockquote class="blockquote">
<p>What is important, and one of the reasons why Spark SQL has been so successful, is that there is no performance difference between the modes. Whatever mode you use to write your structured queries, they all end up as a tree of Catalyst relational data structures. And, yes, you could consider writing structured queries using Catalyst directly, but that could quickly become unwieldy for maintenance (i.e.&nbsp;finding Spark SQL developers who could be comfortable with it as well as being fairly low-level and therefore possibly too dependent on a specific Spark SQL version).</p>
</blockquote>
</section>
<section id="warmup-compute-the-10-most-popular-names-given-to-babies-in-year-2000." class="level1">
<h1>Warmup: compute the 10 most popular names given to babies in year 2000.</h1>
<section id="using-spark.sql" class="level2">
<h2 class="anchored" data-anchor-id="using-spark.sql">Using <code>spark.sql()</code></h2>
<p>In order to use mode <code>sql</code>, create a temporary view from the <code>DataFrame</code>.</p>
<ol type="1">
<li>What are temporary views made of?</li>
<li>Are there other kind of views in spark’s world?</li>
</ol>
<div id="f06e60f7" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2020-03-09T13:24:46.182881Z&quot;,&quot;start_time&quot;:&quot;2020-03-09T13:24:46.097978Z&quot;}" data-options="{&quot;caption&quot;:false,&quot;complete&quot;:true,&quot;display_data&quot;:true,&quot;display_stream&quot;:true,&quot;dpi&quot;:200,&quot;echo&quot;:true,&quot;evaluate&quot;:false,&quot;f_env&quot;:null,&quot;f_pos&quot;:&quot;htpb&quot;,&quot;f_size&quot;:[6,4],&quot;f_spines&quot;:true,&quot;fig&quot;:true,&quot;include&quot;:true,&quot;name&quot;:null,&quot;option_string&quot;:&quot;evaluate=False&quot;,&quot;results&quot;:&quot;verbatim&quot;,&quot;term&quot;:false,&quot;wrap&quot;:&quot;output&quot;}" data-execution_count="6">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>Catalog(spark).listTables()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>[]</code></pre>
</div>
</div>
<div id="827c9f76" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2020-03-09T13:24:47.506183Z&quot;,&quot;start_time&quot;:&quot;2020-03-09T13:24:47.433521Z&quot;}" data-execution_count="7">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>Catalog(spark).listTables()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>[]</code></pre>
</div>
</div>
</section>
<section id="a-query-is-a-plain-sql-query-embodied-in-a-string." class="level2">
<h2 class="anchored" data-anchor-id="a-query-is-a-plain-sql-query-embodied-in-a-string.">A query is a plain SQL query embodied in a string.</h2>
<div id="83bfa8c4" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2020-03-09T13:24:51.637337Z&quot;,&quot;start_time&quot;:&quot;2020-03-09T13:24:51.633088Z&quot;}" data-options="{&quot;caption&quot;:false,&quot;complete&quot;:true,&quot;display_data&quot;:true,&quot;display_stream&quot;:true,&quot;dpi&quot;:200,&quot;echo&quot;:true,&quot;evaluate&quot;:false,&quot;f_env&quot;:null,&quot;f_pos&quot;:&quot;htpb&quot;,&quot;f_size&quot;:[6,4],&quot;f_spines&quot;:true,&quot;fig&quot;:true,&quot;include&quot;:true,&quot;name&quot;:null,&quot;option_string&quot;:&quot;evaluate=False&quot;,&quot;results&quot;:&quot;verbatim&quot;,&quot;term&quot;:false,&quot;wrap&quot;:&quot;output&quot;}" data-execution_count="8">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""TODO: """</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># spark.sql(query)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<p>This phrasing is not consistent with the DRY principle. Fix this using formatted strings.</p>
</blockquote>
</section>
<section id="using-the-dataframedataset-api" class="level2">
<h2 class="anchored" data-anchor-id="using-the-dataframedataset-api">Using the dataframe/dataset API</h2>
<p>This can also be done using Spark SQL API.</p>
<section id="pedestrian-approach" class="level3">
<h3 class="anchored" data-anchor-id="pedestrian-approach">Pedestrian approach</h3>
<ol type="1">
<li>First select <code>10</code> most popular names for girls in year <code>2000</code>, define <code>spark</code> dataframe <code>top10_2000_f</code>.</li>
<li>Does the definition of <code>top10_2000_f</code> involve <em>transformations</em>, <em>actions</em> or both?</li>
<li>What is the type of the result returned by <code>top10_2000_f.take(2)</code>? the type of elements of the result?</li>
</ol>
<div id="3900391c" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2020-03-09T13:24:55.503493Z&quot;,&quot;start_time&quot;:&quot;2020-03-09T13:24:55.499582Z&quot;}" data-options="{&quot;caption&quot;:false,&quot;complete&quot;:true,&quot;display_data&quot;:true,&quot;display_stream&quot;:true,&quot;dpi&quot;:200,&quot;echo&quot;:true,&quot;evaluate&quot;:false,&quot;f_env&quot;:null,&quot;f_pos&quot;:&quot;htpb&quot;,&quot;f_size&quot;:[6,4],&quot;f_spines&quot;:true,&quot;fig&quot;:true,&quot;include&quot;:true,&quot;name&quot;:null,&quot;option_string&quot;:&quot;evaluate=False&quot;,&quot;results&quot;:&quot;verbatim&quot;,&quot;term&quot;:false,&quot;wrap&quot;:&quot;output&quot;}" data-execution_count="9">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># top10_2000_f = </span><span class="al">TODO</span><span class="co">:</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>Do the same thing for boys.</li>
</ol>
<div id="a99eda5c" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2020-03-09T13:24:55.990063Z&quot;,&quot;start_time&quot;:&quot;2020-03-09T13:24:55.985300Z&quot;}" data-options="{&quot;caption&quot;:false,&quot;complete&quot;:true,&quot;display_data&quot;:true,&quot;display_stream&quot;:true,&quot;dpi&quot;:200,&quot;echo&quot;:true,&quot;evaluate&quot;:false,&quot;f_env&quot;:null,&quot;f_pos&quot;:&quot;htpb&quot;,&quot;f_size&quot;:[6,4],&quot;f_spines&quot;:true,&quot;fig&quot;:true,&quot;include&quot;:true,&quot;name&quot;:null,&quot;option_string&quot;:&quot;evaluate=False&quot;,&quot;results&quot;:&quot;verbatim&quot;,&quot;term&quot;:false,&quot;wrap&quot;:&quot;output&quot;}" data-execution_count="10">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># top10_2000_m = </span><span class="al">TODO</span><span class="co">:</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>Compute the <em>union</em> of the two spark dataframes. Store the result in dataframe <code>top10_2000</code></li>
</ol>
<div id="1943fc14" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2020-03-09T13:24:56.565469Z&quot;,&quot;start_time&quot;:&quot;2020-03-09T13:24:56.561072Z&quot;}" data-options="{&quot;caption&quot;:false,&quot;complete&quot;:true,&quot;display_data&quot;:true,&quot;display_stream&quot;:true,&quot;dpi&quot;:200,&quot;echo&quot;:true,&quot;evaluate&quot;:false,&quot;f_env&quot;:null,&quot;f_pos&quot;:&quot;htpb&quot;,&quot;f_size&quot;:[6,4],&quot;f_spines&quot;:true,&quot;fig&quot;:true,&quot;include&quot;:true,&quot;name&quot;:null,&quot;option_string&quot;:&quot;evaluate=False&quot;,&quot;results&quot;:&quot;verbatim&quot;,&quot;term&quot;:false,&quot;wrap&quot;:&quot;output&quot;}" data-execution_count="11">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># top10_2000 = </span><span class="al">TODO</span><span class="co">:</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="do-it-again-complying-with-dry-principle" class="level3">
<h3 class="anchored" data-anchor-id="do-it-again-complying-with-dry-principle">Do it again, complying with DRY principle</h3>
<div id="958dbebb" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2020-03-09T13:24:57.142207Z&quot;,&quot;start_time&quot;:&quot;2020-03-09T13:24:57.139678Z&quot;}" data-options="{&quot;caption&quot;:false,&quot;complete&quot;:true,&quot;display_data&quot;:true,&quot;display_stream&quot;:true,&quot;dpi&quot;:200,&quot;echo&quot;:true,&quot;evaluate&quot;:false,&quot;f_env&quot;:null,&quot;f_pos&quot;:&quot;htpb&quot;,&quot;f_size&quot;:[6,4],&quot;f_spines&quot;:true,&quot;fig&quot;:true,&quot;include&quot;:true,&quot;name&quot;:null,&quot;option_string&quot;:&quot;evaluate=False&quot;,&quot;results&quot;:&quot;verbatim&quot;,&quot;term&quot;:false,&quot;wrap&quot;:&quot;output&quot;}" data-execution_count="12">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">:</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="name-portfolio-through-ages" class="level1">
<h1>Name portfolio through ages</h1>
<ol type="1">
<li>Compute for each year and sex the number of distinct names given that year.</li>
</ol>
<div id="b8ef5bc7" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2020-03-09T13:24:57.707985Z&quot;,&quot;start_time&quot;:&quot;2020-03-09T13:24:57.705093Z&quot;}" data-options="{&quot;caption&quot;:false,&quot;complete&quot;:true,&quot;display_data&quot;:true,&quot;display_stream&quot;:true,&quot;dpi&quot;:200,&quot;echo&quot;:true,&quot;evaluate&quot;:false,&quot;f_env&quot;:null,&quot;f_pos&quot;:&quot;htpb&quot;,&quot;f_size&quot;:[6,4],&quot;f_spines&quot;:true,&quot;fig&quot;:true,&quot;include&quot;:true,&quot;name&quot;:null,&quot;option_string&quot;:&quot;evaluate=False&quot;,&quot;results&quot;:&quot;verbatim&quot;,&quot;term&quot;:false,&quot;wrap&quot;:&quot;output&quot;}" data-execution_count="13">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># nb_names_year_sex = </span><span class="al">TODO</span><span class="co">: </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>Plot the evolution of the number of distinct names as a function of <code>year</code>. Use some aesthetics to distinguish sexes.</li>
</ol>
<div id="6c5c303c" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2020-03-09T13:24:58.841340Z&quot;,&quot;start_time&quot;:&quot;2020-03-09T13:24:58.838607Z&quot;}" data-options="{&quot;caption&quot;:false,&quot;complete&quot;:true,&quot;display_data&quot;:true,&quot;display_stream&quot;:true,&quot;dpi&quot;:200,&quot;echo&quot;:true,&quot;evaluate&quot;:false,&quot;f_env&quot;:null,&quot;f_pos&quot;:&quot;htpb&quot;,&quot;f_size&quot;:[6,4],&quot;f_spines&quot;:true,&quot;fig&quot;:true,&quot;include&quot;:true,&quot;name&quot;:null,&quot;option_string&quot;:&quot;evaluate=False&quot;,&quot;results&quot;:&quot;verbatim&quot;,&quot;term&quot;:false,&quot;wrap&quot;:&quot;output&quot;}" data-execution_count="14">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">:</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="assessing-popularity-through-time" class="level1">
<h1>Assessing popularity through time</h1>
<ol type="1">
<li>For each year and sex, compute the total number of births</li>
<li>Plot the evolution of the sex ratio over time</li>
<li>For each year, sex, and name compute the percentage of newborns given that name for that given year.</li>
</ol>
<blockquote class="blockquote">
<p>Use <code>Window</code> functions.</p>
</blockquote>
<div id="0405e09d" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2020-03-09T13:24:59.635054Z&quot;,&quot;start_time&quot;:&quot;2020-03-09T13:24:59.632434Z&quot;}" data-options="{&quot;caption&quot;:false,&quot;complete&quot;:true,&quot;display_data&quot;:true,&quot;display_stream&quot;:true,&quot;dpi&quot;:200,&quot;echo&quot;:true,&quot;evaluate&quot;:false,&quot;f_env&quot;:null,&quot;f_pos&quot;:&quot;htpb&quot;,&quot;f_size&quot;:[6,4],&quot;f_spines&quot;:true,&quot;fig&quot;:true,&quot;include&quot;:true,&quot;name&quot;:null,&quot;option_string&quot;:&quot;evaluate=False&quot;,&quot;results&quot;:&quot;verbatim&quot;,&quot;term&quot;:false,&quot;wrap&quot;:&quot;output&quot;}" data-execution_count="15">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">:</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="38ee6477" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2020-03-09T13:24:59.913962Z&quot;,&quot;start_time&quot;:&quot;2020-03-09T13:24:59.911037Z&quot;}" data-options="{&quot;caption&quot;:false,&quot;complete&quot;:true,&quot;display_data&quot;:true,&quot;display_stream&quot;:true,&quot;dpi&quot;:200,&quot;echo&quot;:true,&quot;evaluate&quot;:false,&quot;f_env&quot;:null,&quot;f_pos&quot;:&quot;htpb&quot;,&quot;f_size&quot;:[6,4],&quot;f_spines&quot;:true,&quot;fig&quot;:true,&quot;include&quot;:true,&quot;name&quot;:null,&quot;option_string&quot;:&quot;evaluate=False&quot;,&quot;results&quot;:&quot;verbatim&quot;,&quot;term&quot;:false,&quot;wrap&quot;:&quot;output&quot;}" data-execution_count="16">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: plot sex ratio</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># %%</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>Compute for each year, sex and name the <code>row_number</code>, <code>rank</code>, and <code>dense_rank</code> of the name within that year and sex category, when names are sorted by increasing popularity.</li>
</ol>
<div id="60cf14b2" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2020-03-09T13:25:00.180831Z&quot;,&quot;start_time&quot;:&quot;2020-03-09T13:25:00.177889Z&quot;}" data-options="{&quot;caption&quot;:false,&quot;complete&quot;:true,&quot;display_data&quot;:true,&quot;display_stream&quot;:true,&quot;dpi&quot;:200,&quot;echo&quot;:true,&quot;evaluate&quot;:false,&quot;f_env&quot;:null,&quot;f_pos&quot;:&quot;htpb&quot;,&quot;f_size&quot;:[6,4],&quot;f_spines&quot;:true,&quot;fig&quot;:true,&quot;include&quot;:true,&quot;name&quot;:null,&quot;option_string&quot;:&quot;evaluate=False&quot;,&quot;results&quot;:&quot;verbatim&quot;,&quot;term&quot;:false,&quot;wrap&quot;:&quot;output&quot;}" data-execution_count="17">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">:</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="evolution-of-top-popular-names-through-the-century" class="level1">
<h1>Evolution of top popular names through the century</h1>
<ol type="1">
<li>For each sex, select the ten most popular names in year 2000, and plot the proportion of newborns given that name over time. Take into account that some names might have zero occurrence during certain years.</li>
</ol>
<div id="4e8477c9" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2020-03-09T13:25:00.429980Z&quot;,&quot;start_time&quot;:&quot;2020-03-09T13:25:00.427263Z&quot;}" data-options="{&quot;caption&quot;:false,&quot;complete&quot;:true,&quot;display_data&quot;:true,&quot;display_stream&quot;:true,&quot;dpi&quot;:200,&quot;echo&quot;:true,&quot;evaluate&quot;:false,&quot;f_env&quot;:null,&quot;f_pos&quot;:&quot;htpb&quot;,&quot;f_size&quot;:[6,4],&quot;f_spines&quot;:true,&quot;fig&quot;:true,&quot;include&quot;:true,&quot;name&quot;:null,&quot;option_string&quot;:&quot;evaluate=False&quot;,&quot;results&quot;:&quot;verbatim&quot;,&quot;term&quot;:false,&quot;wrap&quot;:&quot;output&quot;}" data-execution_count="18">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">:</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>Use <code>explain()</code> to determine the joining strategy used by spark.</li>
</ol>
</section>
<section id="plot-the-popularity-of-each-of-the-top-ten-achievers-from-year-2000-with-respect-to-time" class="level1">
<h1>Plot the popularity of each of the top ten achievers from year 2000 with respect to time</h1>
<div id="4e1a95aa" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2020-03-09T13:25:00.680650Z&quot;,&quot;start_time&quot;:&quot;2020-03-09T13:25:00.677469Z&quot;}" data-options="{&quot;caption&quot;:false,&quot;complete&quot;:true,&quot;display_data&quot;:true,&quot;display_stream&quot;:true,&quot;dpi&quot;:200,&quot;echo&quot;:true,&quot;evaluate&quot;:false,&quot;f_env&quot;:null,&quot;f_pos&quot;:&quot;htpb&quot;,&quot;f_size&quot;:[6,4],&quot;f_spines&quot;:true,&quot;fig&quot;:true,&quot;include&quot;:true,&quot;name&quot;:null,&quot;option_string&quot;:&quot;evaluate=False&quot;,&quot;results&quot;:&quot;verbatim&quot;,&quot;term&quot;:false,&quot;wrap&quot;:&quot;output&quot;}" data-execution_count="19">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">:</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># %%</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plot-the-total-popularity-of-the-top-ten-achievers-from-year-2000-with-respect-to-time" class="level1">
<h1>Plot the total popularity of the top ten achievers from year 2000 with respect to time</h1>
<div id="a605f4ad" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2020-03-09T13:25:00.924571Z&quot;,&quot;start_time&quot;:&quot;2020-03-09T13:25:00.917339Z&quot;}" data-options="{&quot;caption&quot;:false,&quot;complete&quot;:true,&quot;display_data&quot;:true,&quot;display_stream&quot;:true,&quot;dpi&quot;:200,&quot;echo&quot;:true,&quot;evaluate&quot;:false,&quot;f_env&quot;:null,&quot;f_pos&quot;:&quot;htpb&quot;,&quot;f_size&quot;:[6,4],&quot;f_spines&quot;:true,&quot;fig&quot;:true,&quot;include&quot;:true,&quot;name&quot;:null,&quot;option_string&quot;:&quot;evaluate=False&quot;,&quot;results&quot;:&quot;verbatim&quot;,&quot;term&quot;:false,&quot;wrap&quot;:&quot;output&quot;}" data-execution_count="20">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">:</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># %%</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plot-lorenz-curves" class="level1">
<h1>Plot lorenz curves</h1>
<p>Every year, the name counts define a discrete probability distribution. This distribution, just as income or wealth distribution, is (usually) far from being uniform. We want to assess how uneven it is. We use the tools developed in econometrics.</p>
<p>Without loss of generality, that we handle a distribution over <span class="math inline">\(1, \ldots, n\)</span> where <span class="math inline">\(n\)</span> is the number of distinct names given during a year. We assume that frequencies <span class="math inline">\(p_1, p_2, \ldots, p_n\)</span> are given in ascending order.</p>
<p>The Lorenz function maps <span class="math inline">\([0, 1] \to [0, 1]\)</span>. <span class="math display">\[L(x) = \sum_{i=1}^{\lfloor nx \rfloor} p_i\]</span>.</p>
<ol type="1">
<li>Design a query that adds a column “lorenz” to the dataframe , and for each row computes the value of the Lorenz function defined by <code>year</code> and <code>sex</code>.</li>
</ol>
<div id="896be2e5" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2020-03-09T13:25:01.172487Z&quot;,&quot;start_time&quot;:&quot;2020-03-09T13:25:01.169864Z&quot;}" data-options="{&quot;caption&quot;:false,&quot;complete&quot;:true,&quot;display_data&quot;:true,&quot;display_stream&quot;:true,&quot;dpi&quot;:200,&quot;echo&quot;:true,&quot;evaluate&quot;:false,&quot;f_env&quot;:null,&quot;f_pos&quot;:&quot;htpb&quot;,&quot;f_size&quot;:[6,4],&quot;f_spines&quot;:true,&quot;fig&quot;:true,&quot;include&quot;:true,&quot;name&quot;:null,&quot;option_string&quot;:&quot;evaluate=False&quot;,&quot;results&quot;:&quot;verbatim&quot;,&quot;term&quot;:false,&quot;wrap&quot;:&quot;output&quot;}" data-execution_count="21">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">:</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>Design a function that takes as input a <code>year</code> and plots the Lorenz curve for that year for both sexes.</li>
</ol>
<div id="97df436b" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2020-03-09T13:25:01.435478Z&quot;,&quot;start_time&quot;:&quot;2020-03-09T13:25:01.432499Z&quot;}" data-options="{&quot;caption&quot;:false,&quot;complete&quot;:true,&quot;display_data&quot;:true,&quot;display_stream&quot;:true,&quot;dpi&quot;:200,&quot;echo&quot;:true,&quot;evaluate&quot;:false,&quot;f_env&quot;:null,&quot;f_pos&quot;:&quot;htpb&quot;,&quot;f_size&quot;:[6,4],&quot;f_spines&quot;:true,&quot;fig&quot;:true,&quot;include&quot;:true,&quot;name&quot;:null,&quot;option_string&quot;:&quot;evaluate=False&quot;,&quot;results&quot;:&quot;verbatim&quot;,&quot;term&quot;:false,&quot;wrap&quot;:&quot;output&quot;}" data-execution_count="22">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %%</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">:</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co"># %%</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="gini-index" class="level1">
<h1>Gini index</h1>
<p>The <a href="https://en.wikipedia.org/wiki/Gini_coefficient">Gini index</a> is twice the surface of the area comprised between curves <span class="math inline">\(y=x\)</span> and <span class="math inline">\(y=L(x)\)</span>.</p>
<p>Choose a formula that allows you to compute it efficiently.</p>
<p><span class="math display">\[G={\frac {2\sum _{i=1}^{n}iy_{i}}{n\sum _{i=1}^{n}y_{i}}}-{\frac {n+1}{n}}.\]</span></p>
<ol type="1">
<li><p>Design a query that computes the Gini index of the <code>babynames</code> distribution for every <code>year</code> and <code>sex</code>.</p></li>
<li><p>Plot Gini index over time</p></li>
</ol>
<div id="f9336c1f" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2020-03-09T13:25:01.689514Z&quot;,&quot;start_time&quot;:&quot;2020-03-09T13:25:01.686509Z&quot;}" data-options="{&quot;caption&quot;:false,&quot;complete&quot;:true,&quot;display_data&quot;:true,&quot;display_stream&quot;:true,&quot;dpi&quot;:200,&quot;echo&quot;:true,&quot;evaluate&quot;:false,&quot;f_env&quot;:null,&quot;f_pos&quot;:&quot;htpb&quot;,&quot;f_size&quot;:[6,4],&quot;f_spines&quot;:true,&quot;fig&quot;:true,&quot;include&quot;:true,&quot;name&quot;:null,&quot;option_string&quot;:&quot;evaluate=False&quot;,&quot;results&quot;:&quot;verbatim&quot;,&quot;term&quot;:false,&quot;wrap&quot;:&quot;output&quot;}" data-execution_count="23">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">:</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="4124fb13" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2020-03-09T13:25:01.959724Z&quot;,&quot;start_time&quot;:&quot;2020-03-09T13:25:01.957043Z&quot;}" data-options="{&quot;caption&quot;:false,&quot;complete&quot;:true,&quot;display_data&quot;:true,&quot;display_stream&quot;:true,&quot;dpi&quot;:200,&quot;echo&quot;:true,&quot;evaluate&quot;:false,&quot;f_env&quot;:null,&quot;f_pos&quot;:&quot;htpb&quot;,&quot;f_size&quot;:[6,4],&quot;f_spines&quot;:true,&quot;fig&quot;:true,&quot;include&quot;:true,&quot;name&quot;:null,&quot;option_string&quot;:&quot;evaluate=False&quot;,&quot;results&quot;:&quot;verbatim&quot;,&quot;term&quot;:false,&quot;wrap&quot;:&quot;output&quot;}" data-execution_count="24">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %%</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">:</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co"># %%</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="close-the-door-leave-work-area-clean" class="level1">
<h1>Close the door, leave work area clean</h1>
<div id="31e28212" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2020-03-09T13:25:02.615664Z&quot;,&quot;start_time&quot;:&quot;2020-03-09T13:25:02.216564Z&quot;}" data-execution_count="25">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>spark.stop()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/s-v-b\.github\.io\/MA7BY020\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© Copyright 2024, Stéphane Boucheron</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/s-v-b/MA7BY020/edit/main/projects/homework02.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/s-v-b/MA7BY020/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>This page is built with blood, sweat, tears, and <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>




</body></html>